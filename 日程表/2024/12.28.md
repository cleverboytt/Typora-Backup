# å®‰æ’

- [ ] C++å­¦ä¹  44/94

- [ ] webserveré¡¹ç›®

  ---

  ğŸ‘‡ã€43ã€‘C++ å¯¹è±¡çš„ç”Ÿå­˜æœŸ
  
  æ ˆå¯ä»¥è¢«è®¤ä¸ºæ˜¯ä¸€ç§æ•°æ®ç»“æ„ï¼Œä½ å¯ä»¥åœ¨ä¸Šé¢å †å ä¸€äº›ä¸œè¥¿ã€‚

â€‹	åŸºäºæ ˆçš„å˜é‡å’ŒåŸºäºå †çš„å˜é‡åœ¨å¯¹è±¡ç”Ÿå­˜æœŸä¸Šçš„åŒºåˆ«ï¼š

â€‹	åŸºäºæ ˆçš„å˜é‡ï¼Œåœ¨æˆ‘ä»¬ä¸€å‡ºä½œç”¨åŸŸå°±è¢«é‡Šæ”¾äº†ï¼Œè¢«æ‘§æ¯äº†

```C++

#include<iostream>
#include<string>

class Entity{
public:
    Entity(){
        std::cout<<"Entity created"<<std::endl;
    }
    ~Entity(){
        std::cout<<"Entity destroyed"<<std::endl;
    }
};
int main(){
    {
        Entity e;
    }
    std::cin.get();
}

```

â€‹	åŸºäºå †çš„å˜é‡ï¼Œæ¯”å¦‚è¯´ä½¿ç”¨`new`è¿ç®—ç¬¦åœ¨å †ä¸Šåˆ†é…çš„å†…å­˜ï¼Œéœ€è¦æˆ‘ä»¬æ‰‹åŠ¨é‡Šæ”¾ã€‚

```C++

#include<iostream>
#include<string>

class Entity{
public:
    Entity(){
        std::cout<<"Entity created"<<std::endl;
    }
    ~Entity(){
        std::cout<<"Entity destroyed"<<std::endl;
    }
};
int main(){
    
    Entity* e=new Entity();
    std::cin.get();
    delete e;
}
```

â€‹	ä¸€ä¸ªä¾‹å­ï¼š

```C++

#include<iostream>
#include<string>

class Entity{
public:
    Entity(){
        std::cout<<"Entity created"<<std::endl;
    }
    ~Entity(){
        std::cout<<"Entity destroyed"<<std::endl;
    }
};

class ScopedPtr{
private:
    Entity* m_Ptr;
public:
    ScopedPtr(Entity* ptr)
        :m_Ptr(ptr){
    } 
    ~ScopedPtr(){
        delete m_Ptr;
    }
};
int main(){
    {
        ScopedPtr e = new Entity();
    }
    std::cin.get();
}
```

- [ScopedPtr](vscode-file://vscode-app/d:/Microsoft VS Code/resources/app/out/vs/code/electron-sandbox/workbench/workbench.html) ç±»ç”¨äºç®¡ç† [Entity](vscode-file://vscode-app/d:/Microsoft VS Code/resources/app/out/vs/code/electron-sandbox/workbench/workbench.html) å¯¹è±¡çš„ç”Ÿå‘½å‘¨æœŸã€‚
- å®ƒæœ‰ä¸€ä¸ªç§æœ‰æˆå‘˜å˜é‡ [m_Ptr](vscode-file://vscode-app/d:/Microsoft VS Code/resources/app/out/vs/code/electron-sandbox/workbench/workbench.html)ï¼ŒæŒ‡å‘ä¸€ä¸ª [Entity](vscode-file://vscode-app/d:/Microsoft VS Code/resources/app/out/vs/code/electron-sandbox/workbench/workbench.html) å¯¹è±¡ã€‚
- æ„é€ å‡½æ•°æ¥å—ä¸€ä¸ª [Entity*](vscode-file://vscode-app/d:/Microsoft VS Code/resources/app/out/vs/code/electron-sandbox/workbench/workbench.html) ç±»å‹çš„æŒ‡é’ˆï¼Œå¹¶å°†å…¶èµ‹å€¼ç»™ [m_Ptr](vscode-file://vscode-app/d:/Microsoft VS Code/resources/app/out/vs/code/electron-sandbox/workbench/workbench.html)ã€‚
- ææ„å‡½æ•°åœ¨ [ScopedPtr](vscode-file://vscode-app/d:/Microsoft VS Code/resources/app/out/vs/code/electron-sandbox/workbench/workbench.html) å¯¹è±¡é”€æ¯æ—¶è°ƒç”¨ `delete` è¿ç®—ç¬¦é‡Šæ”¾ [m_Ptr](vscode-file://vscode-app/d:/Microsoft VS Code/resources/app/out/vs/code/electron-sandbox/workbench/workbench.html) æŒ‡å‘çš„å†…å­˜ã€‚

---

ğŸ‘‡ã€44ã€‘C++ çš„æ™ºèƒ½æŒ‡é’ˆ

æ™ºèƒ½æŒ‡é’ˆæœ¬è´¨ä¸Šæ˜¯ä¸€ä¸ªåŸå§‹æŒ‡é’ˆçš„åŒ…è£…ï¼Œå½“ä½ åˆ›å»ºä¸€ä¸ªæ™ºèƒ½æŒ‡é’ˆï¼Œå®ƒä¼šè°ƒç”¨newå¹¶ä¸ºä½ åˆ†é…å†…å­˜ï¼Œç„¶ååŸºäºä½ ä½¿ç”¨çš„æ™ºèƒ½æŒ‡é’ˆï¼Œè¿™äº›å†…å­˜ä¼šåœ¨æŸä¸€æ—¶åˆ»è‡ªåŠ¨é‡Šæ”¾ã€‚

`unique_ptr`æ˜¯ä½œç”¨åŸŸæŒ‡é’ˆï¼Œæ˜¯è¶…å‡ºä½œç”¨åŸŸæ—¶ï¼Œå®ƒä¼šè¢«é”€æ¯ï¼Œç„¶åè°ƒç”¨`delete`

è¦è®¿é—®æ‰€æœ‰çš„æ™ºèƒ½æŒ‡é’ˆï¼Œé¦–å…ˆè¦åšçš„æ˜¯åŒ…æ‹¬`memory`å¤´æ–‡ä»¶

```C++
#include<iostream>
#include<string>
#include<memory>
class Entity{
public:
    Entity(){
        std::cout<<"Entity created"<<std::endl;
    }
    ~Entity(){
        std::cout<<"Entity destroyed"<<std::endl;
    }

    void print(){}

};
class ScopedPtr{
private:
    Entity* m_Ptr;
public:
    ScopedPtr(Entity* ptr)
        :m_Ptr(ptr){
    } 
    ~ScopedPtr(){
        delete m_Ptr;
    }
};
int main(){
    {
        std::unique_ptr<Entity> entity=std::make_unique<Entity>();
    }
    std::cin.get();
}
```

`std::unique_ptr<Entity>` è¡¨ç¤ºä¸€ä¸ªç‹¬å æ‰€æœ‰æƒçš„æ™ºèƒ½æŒ‡é’ˆï¼Œç®¡ç†ä¸€ä¸ª [Entity](vscode-file://vscode-app/d:/Microsoft VS Code/resources/app/out/vs/code/electron-sandbox/workbench/workbench.html) ç±»å‹çš„å¯¹è±¡ã€‚`std::make_unique<Entity>()` åˆ›å»ºä¸€ä¸ª [Entity](vscode-file://vscode-app/d:/Microsoft VS Code/resources/app/out/vs/code/electron-sandbox/workbench/workbench.html) å¯¹è±¡ï¼Œå¹¶è¿”å›ä¸€ä¸ªç®¡ç†è¯¥å¯¹è±¡çš„ `std::unique_ptr<Entity>`ã€‚



`shared_ptr`å’Œ`weak_ptr`æ²¡å¤ªçœ‹æ‡‚QAQ           

---

